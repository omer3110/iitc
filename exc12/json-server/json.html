<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .form-container {
            display: none;
        }

        .form-container.visible {
            display: block;
        }
    </style>
</head>

<body>
    <div class="main">
        <h3>Users Manage</h3>
        <button onclick="showForm('new-user-form')">Create New User</button>
        <button onclick="showForm('update-user-form')">Update User</button>
        <button onclick="showForm('delete-user-form')">Delete User</button>

        <div id="new-user-form" class="form-container">
            <form class="new-user-form">
                <h3>Create new user</h3>
                <input id="firstName" type="text" placeholder="First Name" required>
                <input id="lastName" type="text" placeholder="Last Name" required>
                <button id="submit" type="submit">Submit</button>
            </form>
        </div>

        <div id="update-user-form" class="form-container">
            <form class="new-user-form">
                <h3>Update a user</h3>
                <input id="updateID" type="text" placeholder="ID of user that needs update" required>
                <input id="updatedFirstName" type="text" placeholder="First Name" required>
                <input id="updatedLastName" type="text" placeholder="Last Name" required>
                <button id="submit" type="submit">Submit</button>
            </form>
        </div>

        <div id="delete-user-form" class="form-container">
            <form id="delete-user-by-id">
                <h3>Delete user by ID</h3>
                <input id="ID" type="text" placeholder="ID" required>
                <button id="submit" type="submit">Submit</button>
            </form>
        </div>

        <div class="message"></div>
        <h4>Users table</h4>
        <div id="table-container">
            <button onclick="fetchAndBuildTable()">Get all users</button>
        </div>

        <script src="https://unpkg.com/axios@1.6.7/dist/axios.min.js"></script>
        <script>
            const urlUsers = "http://localhost:8001/users";

            let elemMessage = document.querySelector('.message');

            function showForm(formId) {
                const forms = document.querySelectorAll('.form-container');
                forms.forEach(form => {
                    if (form.id === formId) {
                        form.classList.add('visible');
                    } else {
                        form.classList.remove('visible');
                    }
                });
            }

            function fetchAndBuildTable() {
                axios.get(urlUsers)
                    .then(function (response) {
                        const data = response.data;
                        console.log(data);
                        buildTable(data);
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            }

            function buildTable(data) {
                const tableContainer = document.getElementById("table-container");

                const table = document.createElement("table");
                table.setAttribute("border", "1");

                const headers = ["ID", "First Name", "Last Name"];
                const headerRow = document.createElement("tr");
                headers.forEach(headerText => {
                    const th = document.createElement("th");
                    th.textContent = headerText;
                    headerRow.appendChild(th);
                });
                table.appendChild(headerRow);

                data.forEach(post => {
                    const row = document.createElement("tr");
                    const idCell = document.createElement("td");
                    const firstNameCell = document.createElement("td");
                    const lastNameCell = document.createElement("td");

                    idCell.textContent = post.id;
                    firstNameCell.textContent = post.firstName;
                    lastNameCell.textContent = post.lastName;

                    row.appendChild(idCell);
                    row.appendChild(firstNameCell);
                    row.appendChild(lastNameCell);
                    table.appendChild(row);
                });
                tableContainer.innerHTML = "";
                tableContainer.appendChild(table);
            }

            document.getElementById('new-user-form').addEventListener('submit', function (event) {
                event.preventDefault();
                newUser();
            });
            document.getElementById('delete-user-by-id').addEventListener('submit', function (event) {
                event.preventDefault();
                deleteUser();
            });
            document.getElementById('update-user-form').addEventListener('submit', function (event) {
                event.preventDefault();
                updateUser();
            });

            function newUser() {
                let firstNameVal = document.querySelector('#firstName').value;
                let lastNameVal = document.querySelector('#lastName').value;

                axios.post(urlUsers, {
                    "firstName": firstNameVal,
                    "lastName": lastNameVal
                }).then(response => {
                    elemMessage.textContent = "User added successfully!";
                    document.querySelector('#firstName').value = '';
                    document.querySelector('#lastName').value = '';
                    fetchAndBuildTable();
                }).catch(function (error) {
                    console.error(error);
                    elemMessage.textContent = "Failed to add user!";
                });
            }

            function updateUser() {
                let newFirstNameVal = document.querySelector('#updatedFirstName').value;
                let newLastNameVal = document.querySelector('#updatedLastName').value;
                let userIdVal = document.querySelector('#updateID').value;

                axios.put(`${urlUsers}/${userIdVal}`, {
                    "firstName": newFirstNameVal,
                    "lastName": newLastNameVal
                }).then(response => {
                    elemMessage.textContent = "User updated successfully!";
                    document.querySelector('#updateID').value = '';
                    document.querySelector('#updatedFirstName').value = '';
                    document.querySelector('#updatedLastName').value = '';
                    fetchAndBuildTable();
                }).catch(function (error) {
                    console.error(error);
                    elemMessage.textContent = "Failed to update user!";
                });
            }

            function deleteUser() {
                let userIdVal = document.querySelector('#ID').value;
                axios.delete(`${urlUsers}/${userIdVal}`)
                    .then(response => {
                        elemMessage.textContent = `User ${userIdVal} deleted successfully!`;
                        document.querySelector('#ID').value = '';
                        fetchAndBuildTable();
                    })
                    .catch(function (error) {
                        console.error(error);
                        elemMessage.textContent = `Failed to delete user ${userIdVal}!`;
                    });
            }
        </script>
</body>

</html>